- hosts: all
  sudo: yes
  vars:
    - apps: [
       {
          name: staging,
          domain: hiv.optimamodel.com,
          port: 9000,
          repo: "github.com/optimamodel/optima.git",
          branch: develop
        },
        {
          name: sandbox,
          domain: sandbox.optimamodel.com,
          port: 9001,
          repo: "github.com/optimamodel/optima.git",
          branch: develop
        },
        {
          name: legacy,
          domain: ui.optimamodel.com,
          port: 9005,
          repo: "github.com/optimamodel/optima.git",
          branch: backport-twisted-to-master
        }
      ]
    - user: optima
  #pre_tasks:
  #  - apt: update_cache=yes
  roles:
    - {
        role: user
      }
    - {
        role: anaconda
    }
    - {
        role: optima,
        app: "{{ apps.0 }}",
        tags: ["staging"]
      }
    - {
        role: optima,
        app: "{{ apps.1 }}",
        tags: ["sandbox"]
      }
    - {
        role: optimalegacy,
        app: "{{ apps.2 }}",
        tags: ["legacy"]
      }
    - {
        role: rproxy,
        tags: ["rproxy"]
      }
