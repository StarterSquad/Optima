Installation & Configuration
----------------------------

  This component requires ([EB Command Line Tools](http://aws.amazon.com/code/6752709412171743)) and boto.

    # Install boto
	pip install boto

    # Configure AWS parameters in `setup_env.sh` file
	#Set to location of eb tools downloaded. You need to point to the eb executable for your platform. Example:
	export EB="/<parent-directory>/eb/macosx/python2.7/eb"
	export AWS_REPO_SETUP="/<parent-directory>/AWSDevTools/Linux/AWSDevTools-RepositorySetup.sh"

	#Set AWS access key. Can be generated by following instructions under Access keys:
	# http://docs.aws.amazon.com/general/latest/gr/getting-aws-sec-creds.html
	export AWS_ACCESS_KEY_ID="<Access Key>"
	export AWS_SECRET_ACCESS_KEY="<Access Key Secret>"

	#Set region from one of these keys: http://docs.aws.amazon.com/general/latest/gr/rande.html#elasticbeanstalk_region
	export AWS_DEFAULT_REGION="us-east-1"

	#Set defined variables in current shell
	export source setup_env.sh


Architecture
------------

The master thread queues operations to a single request queue. Example of this can be found in `server/src/parallel.py`

	# Imports
	import boto.sqs
	from boto.sqs.message import Message

	# Connect to AWS region.
	conn = boto.sqs.connect_to_region( os.environ['AWS_DEFAULT_REGION'] )
    
	# Get the optima queue. We will error out if no queue is found. This is what is desired.
	optima_queue = conn.get_all_queues( os.environ['AWS_WORKER_QUEUE_PREFIX'] )
	optima_queue = optima_queue[0]

    # A new queue to get response from all slave workers. Needs to be unique across all api calls
    response_queue_id = id_generator()
    q=conn.create_queue(response_queue_id)

    # Prepate a new message
    m = Message()
    m.set_body( json.dumps({'action': 'addition', 'iteration': i, 'parameter': someparameter, 'responseq': response_queue_id } ) )

    # Write to the queue
    optima_queue.write( m )

We will need to capture responses from all workers:

    result = []
    for i in range( nprocesses ):
        # We expect the process to complete in 3 minutes or less
        rs = q.get_messages(num_messages=1, wait_time_seconds=20)
        
        if ( len(rs) > 0 ):
            m = rs[0]
            resp = json.loads( m.get_body() )
            q.delete_message(m)
        
            result.append(resp['output'])
   
    # We are done, delete response q
    q.delete()   


Create an EB Application
------------------------

    # Run setup from parent directory of local git repository
	./worker/run.sh --setup
	
	...
	# Accept default values
	Enter your AWS Access Key ID (current value is "*****"):
	Enter your AWS Secret Access Key (current value is "*****"):
	Setting AWS Elastic Beanstalk region to "US East (Virginia)".
	Enter an AWS Elastic Beanstalk application name (current value is "optima"):
	Enter an AWS Elastic Beanstalk environment name (current value is "optima-env"):
	Setting environment tier to "WebServer::Standard::1.0".
	Setting solution stack to "64bit Amazon Linux 2014.03 v1.0.9 running Python 2.7".
	...
	# Use LoadBalanced
	Select an environment type (current value is "LoadBalanced").
	Available environment types are:
	1) LoadBalanced
	2) SingleInstance
	Select (1 to 2):
	...
	# Select no for RDS instance
	Create an RDS DB Instance? [y/n] (current value is "No"):
	...
	# Select default instance profile
	Attach an instance profile (current value is "aws-elasticbeanstalk-ec2-role"):
	1) [Create a default instance profile]
	2) aws-elasticbeanstalk-ec2-role
	3) [Other instance profile]
	Select (1 to 3):
	...
	# Select default values
	Configuring git
	 AWS Region [default to us-east-1]:
	 AWS Elastic Beanstalk Application [default to optima]: 
	 AWS Elastic Beanstalk Environment [default to optima-env]:
	...
	


Start an EB Application
-----------------------

    # Run command parent directory of local git repository
	./worker/run.sh --start
	
	...
	# Select y when prompted
	Terminate environment? [y/n]: y
	...


Stop an EB Application
----------------------

    # Run command parent directory of local git repository
	./worker/run.sh --stop
	
	...
	# Select y when prompted
	Terminate environment? [y/n]: y
	...


Delete an EB Application
----------------------

    # Run command parent directory of local git repository
	./worker/run.sh --d
	
	...
	# Select y when prompted
	Delete application? [y/n]: y
	...


Push code to EB Application
---------------------------

    # Run command parent directory of local git repository
	git aws.push

