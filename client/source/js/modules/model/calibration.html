<div class="page rich">

    <div class="page_subheader">
        <div class="section grid">
            <form name="CalibrationForm" ng-submit="simulate()">
                <p ng-show="needData" class="error-hint">Please upload Optima spreadsheet first.</p>
                <div class="2">
                    <input class="txbox" type="number" placeholder="Start year" ng-model="simulationOptions.startyear">
                </div>
                <div class="2">
                    <input class="txbox" type="number" name="endYear" placeholder="End year" ng-model="simulationOptions.endyear" more-than="G.dataend">
                    <span ng-show="CalibrationForm.endYear.$error.moreThan" class="error-hint">{{reportDataEndError()}}</span>
                </div>
                <div class="2">
                    <button class="btn" ng-disabled="needData || CalibrationForm.$invalid">View simulation</button>
                </div>
            </form>
        </div>
        <div class="section grid">

            <label class="checkbox-inline">
                <input type="checkbox" ng-disabled="!canDoFitting" ng-model="enableAutomaticCalibration">
                Automatic calibration
            </label>

            <label class="checkbox-inline">
                <input type="checkbox" ng-disabled="!canDoFitting" ng-model="enableManualCalibration">
                Manual calibration
            </label>
            <span ng-show="!canDoFitting" class="info-hint">Run "View Simulation" in order to enable data calibration</span>
        </div>

    </div>

    <div class="section" ng-if="enableAutomaticCalibration">
        <div class="well section">
            <div class="grid">
                <h2>Automatic calibration</h2>

                <div class="elastic_col __va-middle text-right">
                    <div class="elastic __fluid float-right">

                        <div class="elastic_col __shrink">
                            <label>
                                Maximum time limit:
                                <select class="txbox __inline" style="width: 120px" ng-model="simulationOptions.timelimit">
                                    <option value="10">10 seconds</option>
                                    <option value="30">30 seconds</option>
                                    <option value="60">1 minute</option>
                                    <option value="300">5 minutes</option>
                                    <option value="600">10 minutes</option>
                                    <option value="1800">30 minutes</option>
                                    <option value="3600">1 hour</option>
                                </select>
                            </label>
                        </div>

                        <div class="elastic_col __shrink">
                            <button class="btn" style="background: #008800;" ng-click="startAutoCalibration()">Start calibration</button>
                        </div>
                        <div class="elastic_col __shrink">
                            <button class="btn" style="background: #ff0000;" ng-click="stopAutoCalibration()" ng-disabled="!calibrationStatus">Stop calibration</button>
                        </div>
                        <div class="elastic_col __shrink">
                            <button class="btn" ng-click="saveCalibration()" ng-disabled="calibrationStatus">Save calibration</button>
                        </div>
                        <div class="elastic_col __shrink">
                            <button class="btn" ng-click="revertCalibration()" ng-disabled="calibrationStatus">Revert</button>
                        </div>
                    </div>
                </div>
                <div class="info-hint" ng-show="calibrationStatus">
                    {{reportCalibrationStatus()}}
                </div>
                <div class="error-hint" ng-show="errorText">
                    {{errorText}}
                </div>

            </div>
        </div>
    </div>

    <div class="well section __inline calibration-charts" ng-class="{'calibration-charts--full':enableManualCalibration===false}" ng-show="charts.length>0" >
        <div class="grid">
            <export-all-charts name="Model calibration" ng-if="charts"></export-all-charts>
            <export-all-data name="Model calibration" charts="charts" ng-if="charts"></export-all-data>
            <div>
                <div class="chart-container __small" ng-style="hasStackedCharts && {'height':'400px'}" ng-repeat="chart in charts">
                    <div ng-if="chart.type == 'lineScatterAreaChart'" line-scatter-area-chart ng-if="chart.type != 'stackAreaChart'" data="chart.data" options="chart.options" save-graph-as></div>
                    <div ng-if="chart.type == 'stackedAreaChart'" stacked-area-chart data="chart.data" options="chart.options" save-graph-as></div>
                </div>
            </div>
        </div>
    </div>

    <div class="section __inline manual-calibration" ng-if="enableManualCalibration">
        <div class="well section">
            <div class="grid">

                <h2>Manual calibration</h2>
                <table class="section table table-bordered">
                    <thead>
                    <tr>
                        <td><b>Parameter</b></td>
                        <td style="width:35%"><b>Value</b></td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="parameter in parameters.m">
                        <td>{{parameter.title}}</td>
                        <td>
                            <span ng-hide="editing" ng-click="editing = true">{{ parameter.data}}</span>
              <span ng-show="editing">
                <input class="txbox __inline" ng-model="parameter.data">
                <button class="btn" ng-click="editing = false; doneEditingParameter();">Ok</button>
              </span>
                        </td>                        
                    </tr>
                    <!-- Force -->
                    <tr ng-repeat="population in parameters.meta.pops.short track by $index">
                        <td>{{ parameters.types.force }} {{ population }}</td>
                        <td>
                            <span ng-hide="editing" ng-click="editing = true">{{ parameters.f.force[$index] }}</span>
              <span ng-show="editing">
                <input class="txbox __inline" ng-model="parameters.f.force[$index]">
                <button class="btn" ng-click="editing = false; doneEditingParameter();">Ok</button>
              </span>
                        </td>
                    </tr>
                    <!-- Init -->
                    <tr ng-repeat="population in parameters.meta.pops.short track by $index">
                        <td>{{ parameters.types.init }} {{ population }}</td>
                        <td>
                            <span ng-hide="editing" ng-click="editing = true">{{ parameters.f.init[$index] }}</span>
              <span ng-show="editing">
                <input class="txbox __inline" ng-model="parameters.f.init[$index]">
                <button class="btn" ng-click="editing = false; doneEditingParameter();">Ok</button>
              </span>
                        </td>
                    </tr>
                    <!-- Testing Rate -->
                    <tr ng-repeat="i in [0, 1, 2, 3] track by $index">
                        <td>{{ parameters.types.dx[i] }}</td>
                        <td>
                            <span ng-hide="editing" ng-click="editing = true">{{ parameters.f.dx[i] }}</span>
              <span ng-show="editing">
                <input class="txbox __inline" ng-model="parameters.f.dx[i]">
                <button class="btn" ng-click="editing = false; doneEditingParameter();">Ok</button>
              </span>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div class="elastic __fluid">
                    <div class="elastic_col">
                        <button class="btn" ng-click="saveManualCalibration()">Save calibration</button>
                    </div>
                    <div class="elastic_col">
                        <button class="btn" ng-click="revertManualCalibration()">Revert</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
