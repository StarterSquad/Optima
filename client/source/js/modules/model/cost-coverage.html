<div class="page rich">

  <div ng-if="missingModelData">
    <spreadsheet-upload-hint></spreadsheet-upload-hint>
  </div>

  <div ng-if="!missingModelData">

    <div class="section grid">
      <div class="6">
        <label>
          Select a program: <br>
          <select class="txbox"
                  ng-options="p as p.name group by p.category for p in ::state.selectionPrograms"
                  ng-change="changeProgram()"
                  ng-model="state.selectedProgram">
            <option value="">-- Please select a program --</option>
          </select>
        </label>
      </div>
    </div>

    <div class="section" ng-hide="state.selectedProgram.short_name == null">

      <div class="section" style="margin-bottom: 45px">
        <button type="button" class="btn" ng-click="saveModel()">Save model</button>
        <button type="button" class="btn" ng-click="revertModel()">Revert model</button>
        <button type="button" class="btn" ng-click="uploadDefault()" style="margin-left: 27px">Upload default cost-coverage-outcome curves</button>
      </div>


      <div class="section" ng-show="state.hasCostCoverResponse">

        <export-all-charts name="Cost coverage outcome"
                           custom-titles="state.titlesForChartsExport"></export-all-charts>
        <export-all-data charts="state.chartsForDataExport"
                         name="Cost coverage outcome">
        </export-all-data>
        <h1>{{ state.costCoverageChartTitle }}</h1>
        <div class="section elastic">
          <div class="elastic_col __shrink" ng-if="state.costCoverageChart">
            <div class="chart-container">
              <div mpld3-chart="state.costCoverageChart" chart-toolbar></div>
            </div>
          </div>
          <div class="elastic_col">
            <div class="section">
              <form name="state.CostCoverageForm">
                <div ng-messages="state.CostCoverageForm.$error"
                    ng-show="state.CostCoverageForm.$invalid">
                  <div class="error-hint" ng-message="required">First four text boxes must be either all empty, or all have values in them.</div>
                </div>

                <div class="section">
                  1. Specify the saturation coverage level:
                  <input type="number" class="txbox __inline __m"
                         name="state.saturationCoverageLevel"
                         min="1" max="100" step="1"
                         placeholder="e.g. 90"
                         ng-model="state.saturationCoverageLevel"
                         ng-required="costCoverageFormIsPartlyFilledOut()"
                         more-than="state.knownMaxCoverageLevel"
                         ng-change="updateCurves()">%

                  <div ng-messages="state.CostCoverageForm.state.saturationCoverageLevel.$error"
                       ng-show="state.CostCoverageForm.state.saturationCoverageLevel.$touched && state.CostCoverageForm.state.saturationCoverageLevel.$invalid">
                    <div class="error-hint" ng-message="min">The minimum value is 1</div>
                    <div class="error-hint" ng-message="max">The maximum value is 100</div>
                    <div class="error-hint" ng-message="moreThan">The value must be greater than Known Maximum Coverage Level ({{ state.knownMaxCoverageLevel }}%)</div>
                    <div class="error-hint" ng-message="number">The value should be a number from 1 to 100</div>
                  </div>
                </div>
                <div class="section">
                  2. The estimated amount of funding needed to get between
                  <input type="number" class="txbox __inline __m"
                         name="state.knownMinCoverageLevel"
                         min="1" max="100"
                         placeholder="e.g. 50"
                         less-than="state.knownMaxCoverageLevel"
                         ng-model="state.knownMinCoverageLevel"
                         ng-required="costCoverageFormIsPartlyFilledOut()"
                         ng-change="updateCurves()">%
                  and
                  <input type="number" class="txbox __inline __m"
                         name="state.knownMaxCoverageLevel"
                         min="1" max="100"
                         placeholder="e.g. 60"
                         ng-model="state.knownMaxCoverageLevel"
                         ng-required="costCoverageFormIsPartlyFilledOut()"
                         ng-change="updateCurves()">%
                  coverage for this program is:
                  <input type="number" class="txbox __inline __xl"
                         name="state.knownFundingValue"
                         min="1" step="1000" placeholder="e.g. 400000"
                         ng-model="state.knownFundingValue"
                         ng-required="costCoverageFormIsPartlyFilledOut()"
                         ng-change="updateCurves()"> USD

                  <div ng-messages="state.CostCoverageForm.state.knownMinCoverageLevel.$error"
                       ng-show="state.CostCoverageForm.state.knownMinCoverageLevel.$touched && state.CostCoverageForm.state.knownMinCoverageLevel.$invalid">
                    <div class="error-hint" ng-message="required">The field Known Minimum Coverage Level is required</div>
                    <div class="error-hint" ng-message="min">The minimum value is 1</div>
                    <div class="error-hint" ng-message="max">The maximum value is 100</div>
                    <div class="error-hint" ng-message="lessThan">The value must be less than Known Maximum Coverage Level</div>
                    <div class="error-hint" ng-message="number">The value should be a number from 1 to 100</div>
                  </div>

                  <div ng-messages="state.CostCoverageForm.state.knownMaxCoverageLevel.$error"
                       ng-show="state.CostCoverageForm.state.knownMaxCoverageLevel.$touched && state.CostCoverageForm.state.knownMaxCoverageLevel.$invalid">
                    <div class="error-hint" ng-message="required">The field Known Maximum Coverage Level is required</div>
                    <div class="error-hint" ng-message="min">The minimum value is 1</div>
                    <div class="error-hint" ng-message="max">The maximum value is 100</div>
                    <div class="error-hint" ng-message="number">The value should be a number from 1 to 100</div>
                  </div>

                  <div ng-messages="state.CostCoverageForm.state.knownFundingValue.$error"
                       ng-show="state.CostCoverageForm.state.knownFundingValue.$touched && state.CostCoverageForm.state.knownFundingValue.$invalid">
                    <div class="error-hint" ng-message="required">The field Known Funding Value is required</div>
                    <div class="error-hint" ng-message="min">The minimum value is 1</div>
                    <div class="error-hint" ng-message="number">The value should be a number</div>
                  </div>
                </div>
                <div class="section">
                  3. [Optional] Specify scale-up parameters:
                  <input type="number" class="txbox __inline __xl"
                         name="state.scaleUpParameter"
                         min="0" max="0.999999999999"
                         placeholder="e.g. 0.5"
                         ng-model="state.scaleUpParameter"
                         ng-change="updateCurves()">
                  <div ng-messages="state.CostCoverageForm.state.scaleUpParameter.$error"
                       ng-show="state.CostCoverageForm.state.scaleUpParameter.$touched && state.CostCoverageForm.state.scaleUpParameter.$invalid">
                    <div class="error-hint" ng-message="max">The maximum value is 0.999999999999</div>
                    <div class="error-hint" ng-message="min">The minimum value is 0</div>
                    <div class="error-hint" ng-message="number">The value should be a number from 0 to 0.999999999999</div>
                  </div>
                </div>
                <div class="section">
                  4. [Optional] Full coverage would avert
                  <input type="number" class="txbox __inline __xl"
                         name="state.nonHivDalys"
                         min="0" step="1" placeholder="e.g. 0"
                         ng-model="state.nonHivDalys"
                         ng-change="updateCurves()">
                  non-HIV-related DALYs per year
                  <div ng-messages="state.CostCoverageForm.state.nonHivDalys.$error"
                       ng-show="state.CostCoverageForm.state.nonHivDalys.$touched && state.CostCoverageForm.state.nonHivDalys.$invalid">
                    <div class="error-hint" ng-message="min">The minimum value is 0</div>
                    <div class="error-hint" ng-message="number">The value should be a number</div>
                  </div>
                </div>
                <div class="section">
                  5. [Optional] Specify the maximum funding (for plotting only):
                  <input type="number" class="txbox __inline __xl"
                         name="state.xAxisMaximum"
                         min="1" placeholder="e.g. 1000000"
                         ng-model="state.xAxisMaximum"
                         ng-change="updateCurves()">
                  <div ng-messages="state.CostCoverageForm.state.xAxisMaximum.$error"
                       ng-show="state.CostCoverageForm.state.xAxisMaximum.$touched && state.CostCoverageForm.state.xAxisMaximum.$invalid">
                    <div class="error-hint" ng-message="min">The minimum value is 1</div>
                    <div class="error-hint" ng-message="number">The value should be a number</div>
                  </div>
                </div>
                <div class="section">
                  6. [Optional] Display program cost data in
                  <input type="number" class="txbox __inline __l"
                         name="state.displayYear"
                         placeholder="e.g.{{ ::projectInfo.dataEnd }}"
                         min="{{ ::projectInfo.dataStart }}"
                         max="{{ ::projectInfo.dataEnd }}"
                         ng-model="state.displayYear"
                         ng-change="updateCurves()">
                  prices
                  <div ng-messages="state.CostCoverageForm.state.displayYear.$error"
                       ng-show="state.CostCoverageForm.state.displayYear.$touched && state.CostCoverageForm.state.displayYear.$invalid">
                    <div class="error-hint" ng-message="min">The year entered cannot be before the project start date, which is {{ ::projectInfo.dataStart }}</div>
                    <div class="error-hint" ng-message="max">The year entered cannot be after the project end date, which is {{ ::projectInfo.dataEnd }}</div>
                    <div class="error-hint" ng-message="number">The value should be a number</div>
                  </div>
                </div>
                <div class="section">
                  7. [Optional] Display program costs in dollar spent per person in the targeted population
                  <input type="checkbox" ng-model="state.calculatePerPerson" class="__inline" ng-change="updateCurves()"/>
                </div>
              </form>
            </div>
          </div>
        </div>

        <form name="state.CombinedAdjustmentForms">
          <div class="section" ng-if="state.costOutcomeCharts.length" ng-repeat="chart in state.costOutcomeCharts track by chart.id">
            <h2 class="section">{{ state.outcomeTitles[$index] }}</h2>

            <div class="section elastic">

              <div class="elastic_col __shrink" style="width: 320px">
                <div class="chart-container">
                  <div mpld3-chart="state.coverageOutcomeCharts[$index]" chart-toolbar></div>
                </div>
              </div>

              <div class="elastic_col" style="width: 340px">
                <div class="chart-container">
                  <div mpld3-chart="state.costOutcomeCharts[$index]" chart-toolbar></div>
                </div>
              </div>

              <div ng-form="state.AdjustmentForm{{$index}}" class="elastic_col">
                <h3>Options to adjust curves:</h3>
                <div class="section">
                  1. Behavior/outcome without this program ranges between

                  <input type="number"
                         class="txbox __inline"
                         name="withoutProgramRangeStart"
                         min="0"
                         max="100"
                         step="1"
                         ng-required="costOutcomeFormIsPartlyFilledOut($index)"
                         ng-change="updateCurve($index,state.AdjustmentForm{{$index}})"
                         ng-model="state.coParams[$index][0]"
                         less-than="state.coParams[$index][1]">%
                  and

                  <input type="number" class="txbox __inline"
                         name="withoutProgramRangeEnd"
                         min="0"
                         max="100"
                         step="1"
                         ng-required="costOutcomeFormIsPartlyFilledOut($index)"
                         ng-change="updateCurve($index,state.AdjustmentForm{{$index}})"
                         ng-model="state.coParams[$index][1]"
                         more-than="state.coParams[$index][0]">%

                  <div ng-messages="state.AdjustmentForm{{$index}}.withoutProgramRangeStart.$error"
                       ng-show="state.AdjustmentForm{{$index}}.withoutProgramRangeStart.$invalid">
                    <div class="error-hint" ng-message="min">The minimum value is 0</div>
                    <div class="error-hint" ng-message="max">The maximum value is 100</div>
                    <div class="error-hint" ng-message="lessThan">The first parameter must be lower than the second one</div>
                    <div class="error-hint" ng-message="number">The value should be a number from 0 to 100</div>
                  </div>
                  <div ng-messages="state.AdjustmentForm{{$index}}.withoutProgramRangeEnd.$error"
                       ng-show="state.AdjustmentForm{{$index}}.withoutProgramRangeEnd.$touched && state.AdjustmentForm{{$index}}.withoutProgramRangeEnd.$invalid">
                    <div class="error-hint" ng-message="min">The minimum value is 0</div>
                    <div class="error-hint" ng-message="max">The maximum value is 100</div>
                    <div class="error-hint" ng-message="number">The value should be a number from 0 to 100</div>
                  </div>
                </div>
                <div class="section">
                  2. Behavior/outcome under full coverage of this program ranges between
                  <input type="number"
                         name="fullCoverageRangeStart"
                         min="0"
                         max="100"
                         step="1"
                         ng-required="costOutcomeFormIsPartlyFilledOut($index)"
                         ng-change="updateCurve($index,state.AdjustmentForm{{$index}})"
                         class="txbox __inline"
                         ng-model="state.coParams[$index][2]"
                         less-than="state.coParams[$index][3]">%
                  and
                  <input type="number"
                         name="fullCoverageRangeEnd"
                         min="0"
                         max="100"
                         step="1"
                         ng-required="costOutcomeFormIsPartlyFilledOut($index)"
                         ng-change="updateCurve($index,state.AdjustmentForm{{$index}})"
                         class="txbox __inline"
                         ng-model="state.coParams[$index][3]">%

                  <div ng-messages="state.AdjustmentForm{{$index}}.fullCoverageRangeStart.$error"
                       ng-show="state.AdjustmentForm{{$index}}.fullCoverageRangeStart.$invalid">
                    <div class="error-hint" ng-message="min">The minimum value is 0</div>
                    <div class="error-hint" ng-message="max">The maximum value is 100</div>
                    <div class="error-hint" ng-message="lessThan">The first parameter must be lower than the second one</div>
                    <div class="error-hint" ng-message="number">The value should be a number from 0 to 100</div>
                  </div>
                  <div ng-messages="state.AdjustmentForm{{$index}}.fullCoverageRangeEnd.$error"
                       ng-show="state.AdjustmentForm{{$index}}.fullCoverageRangeEnd.$touched && state.AdjustmentForm{{$index}}.fullCoverageRangeEnd.$invalid">
                    <div class="error-hint" ng-message="min">The minimum value is 0</div>
                    <div class="error-hint" ng-message="max">The maximum value is 100</div>
                    <div class="error-hint" ng-message="number">The value should be a number from 0 to 100</div>
                  </div>

                  <div ng-messages="state.AdjustmentForm{{$index}}.$error"
                      ng-show="state.AdjustmentForm{{$index}}.$invalid &&
                               state.AdjustmentForm{{$index}}.withoutProgramRangeStart.$touched ||
                               state.AdjustmentForm{{$index}}.withoutProgramRangeEnd.$touched ||
                               state.AdjustmentForm{{$index}}.fullCoverageRangeStart.$touched ||
                               state.AdjustmentForm{{$index}}.fullCoverageRangeEnd.$touched">
                    <div class="error-hint" ng-message="required">All four text boxes must be filled out to calculate the curves.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

  </div>
</div>
