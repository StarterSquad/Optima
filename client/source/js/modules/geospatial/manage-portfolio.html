<div class="rich">
  <div class="section">

    <h1>Geospatial Analysis</h1>


    <h2>Preparing districts for analysis</h2>

    <ol>
      <li>
        Choose a project as template for districts
        &nbsp;

        <button
            class="btn __m __inline"
            ng-click="chooseTemplateProject()">Choose project
        </button>

        &nbsp;
        <i ng-if="!state.templateProject.name">No template project selected</i>

        {{ state.templateProject.name}}

        <div
            style="
              border: 1px solid #DDD;
              padding: 20px;"
            ng-show="isSelectTemplateProject">

          <i>Select from optimizable projects:</i>
          <br>
          <div ng-repeat="project in projects">
            <input
              type="radio"
              ng-model="state.templateProject"
              ng-value="project">
            {{project.name}}
          </div>
          <br>
          <br>
          <button class="btn"
            ng-click="dismissSelectTemplateProject()">
            Dismiss
          </button>

          <button class="btn"
            ng-click="saveTemplateProject()">
            Save
          </button>
        </div>
      </li>

      <li>
        Generate template spreadsheet with

          <select
              ng-model="state.nRegion"
              ng-init="2"
              ng-options="n for n in [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50]">
          </select>

        districts for the year

        <select
            ng-model="state.templateYear"
            ng-options="year for year in years">
        </select>

        &nbsp;

        <button
            class="btn __m __inline"
            ng-click="generateTemplateSpreadsheet()"
            ng-disabled=" !state.templateProject || isSelectTemplateProject">
          Generate spreadsheet
        </button>
      </li>

      <li>
        Enter the district populations in the downloaded spreadsheet using Excel
      </li>

      <li>
        Create district projects by uploading the spreadsheet:
        &nbsp;

        <button
            class="btn __m __inline"
            ng-click="spawnRegionsFromSpreadsheet()"
            ng-disabled=" !state.templateProject || isSelectTemplateProject">
          Upload spreadsheet
        </button>

        <div
            style="font-style: italic"
            ng-if="state.prjNames.length > 0">
          New district projects:
          <ul>
            <li ng-repeat="prjName in state.prjNames">{{prjName}}</li>
          </ul>
        </div>
      </li>
      <li>
        Calibrate the new district projects from the <a ui-sref="home">project management</a> page.
      </li>
    </ol>

    <div style="
        width: 100%;
        border-bottom: 1px solid #AAA;
        padding-top: 30px;
        margin-bottom: 30px">
    </div>

    <h2>Select portfolio for geospatial analysis</h2>

    <br>

    Portfolio:
    &nbsp;

    <select
        ng-if="portfolios.length > 0"
        ng-model="state.portfolio"
        ng-options="portfolio as portfolio.name for portfolio in portfolios"
        ng-change="setActiveGaoptim()"
        style="width: 200px;">
    </select>

    <i ng-if="portfolios.length == 0">
      No portfolios have been created
    </i>

    <i
        class="fa fa-file-o"
        ng-click="createPortfolio()"
        tp-text="New" tooltip tp-class="tooltip"
        tp-x="-100" tp-y="-200" tp-anchor-x="0" tp-anchor-y="0"
        style="margin-left: 0.5em">
    </i>

    <i
        class="fa fa-trash-o"
        ng-click="deletePortfolio()"
        tp-text="Delete" tooltip tp-class="tooltip"
        tp-x="-100" tp-y="-200" tp-anchor-x="0" tp-anchor-y="0">
    </i>

    <div
      style="
        display: flex;
        padding-top: 2em;">

      <div style="flex: 0 0 280px">

        <h4>Optimization conditions </h4>

        <br>

        <div
          style="
            width: 230px;
            padding-bottom: 0.1em;"
          ng-repeat="entry in objectiveKeyLabels">
          <label>
            {{entry.label}}
          </label>
          <input
              class="txbox __inline"
              style="
          float: right;
          width:70px;"
              ng-model="state.gaoptim.objectives[entry.key]"
              type="number"/>
          <br clear="all">
        </div>

        <button
            style="
              margin-top: 1em"
              class="btn"
            ng-click="savePortfolio()">
          Save optimization condition
        </button>
      </div>

      <div style="flex: 1">

        <h4>Geospatial analysis of districts</h4>

        <table class="table table-bordered table-hover table-striped">
          <tr>
            <th>Districts</th>
            <th>BOC</th>
            <th></th>
          </tr>
          <tr ng-repeat="project in state.portfolio.projects">
            <td>
              {{project.name}}
            </td>
            <td width="150px">
              <span style="color: #00aeef;">
                  {{bocStatusMessage[project.id]}}
              </span>
            </td>
            <td width="20px">
              <span
                  ng-click="deleteProject(project.id)""
                  class="fa fa-trash">
              </span>
            </td>
          </tr>
          <tr>
            <td colspan="4">
              <button class="btn"
                ng-click="addProject()">
                + import districts from projects
              </button>

              <div
                  style="
                    border: 1px solid #DDD;
                    padding: 20px;"
                  ng-show="isSelectNewProject">

                <i>Select from optimizable projects:</i>
                <br>
                <label ng-repeat="project in projects">
                  <input type="checkbox"
                         ng-model="project.selected">
                  {{project.name}}
                  <br>
                </label>
                <br>
                <br>
                <button class="btn"
                  ng-click="dismissAddProject()">
                  Dismiss
                </button>

                <button class="btn"
                  ng-click="saveSelectedProject()">
                  Save
                </button>
            </div>
            </td>
          </tr>
        </table>

        <button
            style="
              margin-bottom: 1em"
            class="btn"
            ng-click="calculateAllBocCurves()">
          Calculate BOC curves for districts
        </button>

        &nbsp;

        Time per optimization

        <select ng-init="state.bocMaxtime='2'" ng-model="state.bocMaxtime">
          <option value="2">2 seconds</option>
          <option value="10">10 seconds</option>
          <option value="30">30 seconds</option>
          <option value="60">1 minute</option>
          <option value="300">5 minutes</option>
          <option value="600">10 minutes</option>
          <option value="1800">30 minutes</option>
        </select>


        <br>
        <br>
        <button
            class="btn"
            ng-click="runFullGa()"
            ng-disabled="checkBocCurvesNotCalculated()">
          Run geospatial optimization over BOC curves
        </button>

        &nbsp;

        Time per optimization:

        <select ng-init="state.maxtime='2'" ng-model="state.maxtime">
          <option value="2">2 seconds</option>
          <option value="10">10 seconds</option>
          <option value="30">30 seconds</option>
          <option value="60">1 minute</option>
          <option value="300">5 minutes</option>
          <option value="600">10 minutes</option>
          <option value="1800">30 minutes</option>
        </select>
        &nbsp;
        <span style="color: #00aeef; margin-top: 25px; margin-left: 15px">
          {{ statusMessage }}
        </span>

        <br>
        <br>
        <button
            class="btn"
            ng-disabled="hasNoResults()"
            ng-click="exportResults()">
          Results (CSV)
        </button>

      </div>

    </div>

</div>
