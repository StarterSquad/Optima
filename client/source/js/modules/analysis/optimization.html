<div class="rich" style="padding: 10px;">

  <div class="grid" style="margin: 0 -25px;">
    <h1>Analyses &#8594; Optimization</h1>
  </div>

  <div class="rich" style="margin: 0 -25px;" ng-if="!missingData">

    <div class="3">
      <label for="optimization-selection">Select an optimization:</label>
    </div>

    <div style="display: flex;justify-content: flex-start;">
      <select id="optimization-selection"
              name="optimization-selection"
              class="updateGraph txbox"
              ng-model="state.activeOptimization"
              ng-change="setActiveOptimization(state.activeOptimization)"
              ng-options="optimization.name for optimization in state.optimizations"
              style="width: 20%;">
      </select>
      <button ng-click="addOptimization()" type="button" class="btn" style="margin-left:2%">New optimization</button>
      <button ng-click="copyOptimization()" type="button" class="btn" style="margin-left:2%">Copy optimization</button>
      <button ng-click="renameOptimization()" type="button" class="btn" style="margin-left:2%">Rename optimization</button>
      <button ng-click="downloadOptimization()" type="button" class="btn" style="margin-left:2%">Download optimization</button>
      <button ng-click="uploadOptimization()" type="button" class="btn" style="margin-left:2%">Upload optimization</button>
      <button ng-click="deleteOptimization()" type="button" class="btn" style="margin-left:2%">Delete optimization</button>
    </div>

    <div style="width: 100%; margin-top: 25px;">
        <input
            type="button"
            value="Save"
            class="updateGraph btn"
            ng-click="saveOptimizationForm(optimizationForm)"
            ng-disabled="!state.activeOptimization"/>
        &nbsp;
        <input
            type="button"
            value="Run"
            class="updateGraph btn"
            ng-click="runOptimizations()"
            ng-disabled="!state.activeOptimization || !state.activeOptimization.id"/>
        &nbsp;
        <input
            type="button"
            value="Update Graphs"
            class="updateGraph btn"
            ng-click="getOptimizationGraphs()"
            ng-disabled="!state.activeOptimization"/>
        &nbsp;
        <span style="color: #00aeef; margin-top: 25px; margin-left: 15px">
          {{ statusMessage }}
        </span>
        &nbsp;
        <span style="color: red; margin-top: 25px; margin-left: 15px">
          {{ errorMessage }}
        </span>

    </div>

    <div style="display: flex; margin-top: 20px; justify-content: space-between; height: calc(100vh - 300px);">

      <div class="small_bordered_list"
           style="
              margin-left: 10px;
              border: 1px solid #DDD;
              padding: 10px;
              flex: 0 0 400px;
              height: 100%;
              width: 100%;
              overflow:auto">

        <form name="optimizationForm">
          <div>
            <div class="section">
              <div class="label">Program set</div>
              <select class="txbox"
                      name="progset"
                      style="width: 60%;"
                      ng-class="{'invalid': optimizationForm.progset.$invalid}"
                      ng-options="program.id as program.name for program in state.programSetList"
                      ng-change="validateOptimizationForm(optimizationForm)"
                      ng-model="state.activeOptimization.progset_id">
                <option value="">-- Please select a program set --</option>
              </select>
            </div>
            <div class="section">
              <div class="label">Parameter set</div>
              <select class="txbox"
                      name="parset"
                      style="width: 60%;"
                      ng-class="{'invalid': optimizationForm.parset.$invalid}"
                      ng-change="validateOptimizationForm(optimizationForm)"
                      ng-options="parset.id as parset.name for parset in state.parsets"
                      ng-model="state.activeOptimization.parset_id">
                <option value="">-- Please select a parameter set --</option>
              </select>
            </div>
            <div class="section">
              <div class="label">Type</div>
              <div>
                  <span style="width: 45%">
                    <input
                        type="radio"
                        name="objectives_which"
                        ng-click="setType('outcomes')"
                        ng-checked="state.activeOptimization.which==='outcomes'"/>
                    Minimize outcomes
                  </span>
                  <span style="width: 45%">
                    <input
                        type="radio"
                        name="objectives_which"
                        ng-click="setType('money')"
                        ng-checked="state.activeOptimization.which==='money'"/>
                    Minimize money
                  </span>
              </div>
            </div>
            <div ng-if="state.activeOptimization.objectives" class="section">
              <div class="label">Objectives</div>
              <div style="justify-content: space-around" class="option" ng-repeat="objective in state.objectives">
                <span style="width: 70%">{{objective.label}}</span>
                  <span style="width: 30%">
                    <input class="txbox __inline __m"
                      type="number"
                      ng-model="state.activeOptimization.objectives[objective.key]"
                      name="{{objective.key}}"
                      ng-change="validateOptimizationForm(optimizationForm)"
                      ng-class="{'invalid': optimizationForm[objective.key].$invalid}"/>
                  </span>
              </div>
            </div>
            <div ng-if="state.activeOptimization.constraints" class="section">
              <div class="label">Constraints</div>
              <div style="justify-content: space-around; font-weight: bold" class="option">
                <span style="width: 60%">Program Name</span>
                <span style="width: 20%">Minimum</span>
                <span style="width: 20%">Maximum</span>
              </div>
            </div>
            <div style="justify-content: space-around" class="option" ng-repeat="constraintKey in state.constraintKeys">
              <span style="width: 60%">{{ state.activeOptimization.constraints.name[constraintKey] }}</span>
                <span style="width: 20%">
                  <input class="txbox __inline __m" type="number" ng-model="state.activeOptimization.constraints.min[constraintKey]"/>
                </span>
                <span style="width: 20%">
                  <input class="txbox __inline __m" type="number" ng-model="state.activeOptimization.constraints.max[constraintKey]"/>
                </span>
            </div>
          </div>

        </form>
      </div>

      <div
        style="
           margin-left: 10px;
           border: 1px solid #DDD;
           flex: 1 1 auto;
           height:100%;
           width: 100%;
           overflow:auto">

          <optima-graphs graphs="graphs"></optima-graphs>

      </div>


    </div>
  </div>
</div>