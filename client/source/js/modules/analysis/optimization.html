<div class="rich">

  <h1>Optimization analysis</h1>

  <div class="error-hint" ng-show="isMissingData">
    No parameter sets, you need to <a ui-sref="home">upload a data spreadsheet</a> for this project.
  </div>

  <div class="error-hint" ng-show="!isMissingData && isMissingProgramSet">
    Please <a ui-sref="programs.manageProgramSet">add programs to a program set</a>.
  </div>

  <div class="error-hint" ng-show="!isMissingData && !isMissingProgramSet && !isOptimizable">
    Programs not ready, you need to <a ui-sref="programs.define-cost-coverage-outcome">define cost and outcome functions</a>.
  </div>

  <div ng-if="!isMissingData && isOptimizable && !isMissingProgramSet" class="rich"">

    <div
      style="
        display: flex;
        align-items: center">

      Optimization: &nbsp;

      <select
        class="txbox"
        ng-model="state.optimization"
        ng-change="selectOptimization()"
        ng-options="optimization as optimization.name for optimization in state.optimizations"
        style="width: 20%;">
      </select>
      <i
        ng-click="addOptimization()"
        class="fa fa-file-o"
        tp-text="New" tooltip tp-class="tooltip"
        tp-x="-100" tp-y="-200" tp-anchor-x="0" tp-anchor-y="0"
        style="margin-left: 0.5em">
      </i>
      <i
        ng-click="copyOptimization()"
        class="fa fa-copy"
        tp-text="Copy" tooltip tp-class="tooltip"
        tp-x="-100" tp-y="-200" tp-anchor-x="0" tp-anchor-y="0"
        style="margin-left: 0.5em">
      </i>
      <i
        ng-click="renameOptimization()"
        class="fa fa-pencil"
        tp-text="Rename" tooltip tp-class="tooltip"
        tp-x="-100" tp-y="-200" tp-anchor-x="0" tp-anchor-y="0"
        style="margin-left: 0.5em">
      </i>
      <i
        ng-click="downloadOptimization()"
        class="fa fa-download"
        tp-text="Download" tooltip tp-class="tooltip"
        tp-x="-100" tp-y="-200" tp-anchor-x="0" tp-anchor-y="0"
        style="margin-left: 0.5em">
      </i>
      <i
        ng-click="uploadOptimization()"
        class="fa fa-upload"
        tp-text="Upload" tooltip tp-class="tooltip"
        tp-x="-100" tp-y="-200" tp-anchor-x="0" tp-anchor-y="0"
        style="margin-left: 0.5em">
      </i>
      <i
        ng-click="deleteOptimization()"
        class="fa fa-trash-o"
        tp-text="Delete" tooltip tp-class="tooltip"
        tp-x="-100" tp-y="-200" tp-anchor-x="0" tp-anchor-y="0"
        style="margin-left: 0.5em">
      </i>
    </div>

    <div ng-if="state.optimizations.length > 0">
      <div style="width: 100%; margin-top: 10px;">
          <input
            type="button"
            value="Save Optimization"
            class="btn"
            ng-click="saveOptimizationForm(optimizationForm)"
            ng-disabled="checkNotSavale()"/>
          &nbsp;

          <button
            class="btn"
            ng-click="startOptimization()"
            ng-disabled="checkNotRunnable()">
            Run optimization
          </button>
          &nbsp;
          for about
          &nbsp;
          <select ng-init="state.maxtime=10" ng-model="state.maxtime">
            <option value="10">10 seconds</option>
            <option value="30">30 seconds</option>
            <option value="60">1 minute</option>
            <option value="300">5 minutes</option>
            <option value="600">10 minutes</option>
            <option value="1800">30 minutes</option>
          </select>
          &nbsp;
          <span style="color: #00aeef; margin-top: 25px; margin-left: 15px">
            {{ statusMessage }}
          </span>
      </div>

      <div
        style="
          display: flex;
          margin-top: 10px;
          justify-content: space-between;
          height: calc(100vh - 200px);">

      <div
        class="small_bordered_list"
        style="
          border: 1px solid #DDD;
          padding: 10px;
          flex: 0 0 280px;
          height: 100%;
          width: 100%;
          overflow:auto">

        <form name="optimizationForm">
          <div>
            <div class="section">
              <div class="label">Program set</div>
              <select class="txbox"
                      name="progset"
                      style="width: 60%;"
                      ng-class="{'invalid': optimizationForm.progset.$invalid}"
                      ng-options="program.id as program.name for program in state.programSetList"
                      ng-change="validateOptimizationForm(optimizationForm)"
                      ng-model="state.optimization.progset_id">
                <option value="">-- Please select a program set --</option>
              </select>
            </div>
            <div class="section">
              <div class="label">Parameter set</div>
              <select class="txbox"
                      name="parset"
                      style="width: 60%;"
                      ng-class="{'invalid': optimizationForm.parset.$invalid}"
                      ng-change="validateOptimizationForm(optimizationForm)"
                      ng-options="parset.id as parset.name for parset in state.parsets"
                      ng-model="state.optimization.parset_id">
                <option value="">-- Please select a parameter set --</option>
              </select>
            </div>
            <div class="section">
              <div class="label">Type</div>
              <input
                  type="radio"
                  name="objectives_which"
                  ng-click="setType('outcomes')"
                  ng-checked="state.optimization.which==='outcomes'"/>
              Minimize outcomes
              <br>
              <input
                  type="radio"
                  name="objectives_which"
                  ng-click="setType('money')"
                  ng-checked="state.optimization.which==='money'"/>
              Minimize money
            </div>
            <div ng-if="state.optimization.objectives" class="section">
              <div class="label">Objectives</div>
              <div style="justify-content: space-around" class="option" ng-repeat="objectiveLabel in objectiveLabels">
                <span style="width: 70%">{{objectiveLabel.label}}</span>
                  <span style="width: 30%">
                    <input class="txbox __inline __m"
                      type="number"
                      ng-model="state.optimization.objectives[objectiveLabel.key]"
                      name="{{objectiveLabel.key}}"
                      ng-change="validateOptimizationForm(optimizationForm)"
                      ng-class="{'invalid': optimizationForm[objectiveLabel.key].$invalid}"/>
                  </span>
              </div>
            </div>
            <div ng-if="state.optimization.constraints" class="section">
              <div class="label">Constraints</div>
              <div style="justify-content: space-around; font-style: italic" class="option">
                <span style="width: 60%">Program</span>
                <span style="width: 20%">Min</span>
                <span style="width: 20%">Max</span>
              </div>
            </div>
            <div style="justify-content: space-around" class="option" ng-repeat="constraintKey in state.constraintKeys">
              <span style="width: 60%">
                {{ state.optimization.constraints.name[constraintKey] }}
              </span>
              <span style="width: 20%">
                <input class="txbox" type="number" ng-model="state.optimization.constraints.min[constraintKey]"/>
              </span>
              <span style="width: 20%">
                <input class="txbox" type="number" ng-model="state.optimization.constraints.max[constraintKey]"/>
              </span>
            </div>
          </div>

        </form>
      </div>

      <div
        style="
           margin-left: 10px;
           border: 1px solid #DDD;
           flex: 1 1 auto;
           height:100%;
           width: 100%;
           overflow:auto">

          <optima-graphs graphs="graphs"></optima-graphs>

      </div>


    </div>
    </div>
  </div>
</div>